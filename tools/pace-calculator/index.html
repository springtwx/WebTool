<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è·‘æ­¥é…é€Ÿè®¡ç®—å™¨</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%8F%83%3C/text%3E%3C/svg%3E" />
  <style>
    :root {
      color-scheme: light;
      --bg: #f6f7f9;
      --card: #ffffff;
      --text: #1b1f24;
      --muted: #5b6776;
      --accent: #1f5eff;
      --border: #e3e7ee;
      font-family: "Inter", "Noto Sans SC", system-ui, -apple-system, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    [hidden] {
      display: none !important;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    main {
      max-width: 1080px;
      margin: 0 auto;
      padding: 48px 24px 80px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 32px;
    }

    header a {
      color: var(--muted);
      text-decoration: none;
      font-size: 14px;
    }

    header h1 {
      margin: 0;
      font-size: 30px;
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .page-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #eef1f6;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    header p {
      margin: 0;
      color: var(--muted);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .copy-link {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      cursor: pointer;
      transition: border 0.2s ease, color 0.2s ease;
    }

    .copy-link:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 24px;
      box-shadow: 0 12px 24px rgba(14, 23, 38, 0.06);
    }

    .mode-toggle {
      display: inline-flex;
      background: #eef1f6;
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
    }

    .mode-toggle button {
      border: none;
      background: transparent;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 14px;
      color: var(--muted);
      cursor: pointer;
    }

    .mode-toggle button.active {
      background: var(--card);
      color: var(--text);
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(14, 23, 38, 0.08);
    }

    .section {
      display: none;
      margin-top: 24px;
    }

    .section.active {
      display: block;
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
      color: var(--muted);
    }

    select,
    input {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
      color: var(--text);
    }

    .subtle {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }

    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    th,
    td {
      text-align: left;
      padding: 12px 8px;
      border-bottom: 1px solid var(--border);
    }

    th {
      color: var(--muted);
      font-weight: 500;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .result-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .result-card strong {
      font-size: 18px;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 20px 0 8px;
    }

    .unit-toggle {
      display: inline-flex;
      background: #eef1f6;
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
    }

    .unit-toggle button {
      border: none;
      background: transparent;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      color: var(--muted);
      cursor: pointer;
    }

    .unit-toggle button.active {
      background: var(--card);
      color: var(--text);
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(14, 23, 38, 0.08);
    }

    .table-note {
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
    }

    .table-note span {
      color: var(--text);
      font-weight: 600;
    }

    .segment-card {
      margin-top: 20px;
    }

    .segment-card h3 {
      margin: 0 0 8px;
      font-size: 18px;
    }

    .segment-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .segment-toggle select {
      min-width: 160px;
    }

    .hint {
      font-size: 13px;
      color: var(--muted);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f0f4ff;
      color: #1f4acc;
      font-size: 12px;
    }

    .status-pill[data-tone="warn"] {
      background: #fff4ef;
      color: #c24d1d;
    }

    .label-inline {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .label-inline .unit-inline {
      white-space: nowrap;
    }

    .tempo-rows {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
    }

    .tempo-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1.2fr 0.4fr;
      gap: 12px;
      align-items: center;
    }

    .tempo-row--header {
      font-size: 13px;
      color: var(--muted);
    }

    .tempo-row--header span {
      padding-left: 4px;
    }

    .tempo-row .pace-inputs {
      display: grid;
      grid-template-columns: repeat(2, minmax(80px, 1fr));
      gap: 8px;
    }

    .tempo-row .tempo-input {
      display: none;
    }

    .tempo-row .tempo-input.active {
      display: block;
    }

    .tempo-row button {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
    }

    .tempo-actions {
      margin-top: 12px;
      display: flex;
      gap: 12px;
    }

    .tempo-actions button {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
    }

    @media (max-width: 720px) {
      main {
        padding: 40px 20px 64px;
      }

      header h1 {
        font-size: 24px;
      }

      .page-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
      }

      .card {
        padding: 18px;
      }
    }

    @media (max-width: 520px) {
      main {
        padding: 32px 16px 56px;
      }

      .header-actions {
        align-items: flex-start;
      }

      .page-title {
        align-items: flex-start;
      }

      .mode-toggle {
        flex-wrap: wrap;
      }

      table {
        min-width: 420px;
      }

      .tempo-row {
        grid-template-columns: 1fr;
      }

      .tempo-actions {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <a href="../../">â† è¿”å›å·¥å…·é¦–é¡µ</a>
      <div class="header-actions">
        <div class="page-title">
          <span class="page-icon" aria-hidden="true">ğŸƒ</span>
          <h1>è·‘æ­¥é…é€Ÿè®¡ç®—å™¨</h1>
        </div>
        <button class="copy-link" type="button" id="copy-link">å¤åˆ¶æ­¤å·¥å…·é“¾æ¥</button>
      </div>
      <p>åˆ‡æ¢å¿«æ·æ¨¡å¼æˆ–è‡ªç”±æ¨¡å¼ï¼Œå¿«é€Ÿå¾—åˆ°é…é€Ÿã€æ—¶é€Ÿä¸å®Œèµ›æ—¶é—´ã€‚</p>
      <div class="unit-toggle" role="tablist" aria-label="åˆ‡æ¢è·ç¦»å•ä½">
        <button type="button" class="active" data-unit="km">å…¬é‡Œ</button>
        <button type="button" data-unit="mi">è‹±é‡Œ</button>
      </div>
      <div class="mode-toggle" role="tablist">
        <button type="button" class="active" data-mode="quick">å¿«æ·æ¨¡å¼</button>
        <button type="button" data-mode="flex">è‡ªç”±æ¨¡å¼</button>
        <button type="button" data-mode="tempo">èŠ‚å¥è·‘æ¨¡å¼</button>
      </div>
    </header>

    <section class="card section active" id="quick-section">
      <h2>å¿«æ·æ¨¡å¼</h2>
      <p class="subtle">é€‰æ‹©è¾“å…¥ç±»å‹åï¼Œå³å¯çœ‹åˆ°å¸¸è§æ¯”èµ›è·ç¦»çš„é…é€Ÿä¸å®Œèµ›æ—¶é—´ã€‚</p>
      <div class="input-grid">
        <label>
          è¾“å…¥ç±»å‹
          <select id="quick-input-type">
            <option value="pace" selected>é…é€Ÿ</option>
            <option value="time">æ—¶é—´ï¼ˆæ€»ç”¨æ—¶ï¼‰</option>
            <option value="speed">æ—¶é€Ÿ</option>
          </select>
        </label>
        <div data-quick-input="pace">
          <div class="input-grid" style="grid-template-columns: repeat(2, minmax(80px, 1fr));">
            <input type="number" id="pace-min" min="0" placeholder="åˆ†" aria-label="é…é€Ÿ åˆ†é’Ÿ" />
            <input type="number" id="pace-sec" min="0" max="59" placeholder="ç§’" aria-label="é…é€Ÿ ç§’" />
          </div>
        </div>
        <div data-quick-input="time" hidden>
          <div class="input-grid" style="grid-template-columns: repeat(3, minmax(70px, 1fr));">
            <input type="number" id="time-hour" min="0" placeholder="æ—¶" aria-label="æ—¶é—´ å°æ—¶" />
            <input type="number" id="time-min" min="0" max="59" placeholder="åˆ†" aria-label="æ—¶é—´ åˆ†é’Ÿ" />
            <input type="number" id="time-sec" min="0" max="59" placeholder="ç§’" aria-label="æ—¶é—´ ç§’" />
          </div>
        </div>
        <div data-quick-input="speed" hidden>
          <input type="number" id="speed-input" min="0" step="0.1" placeholder="ä¾‹å¦‚ 12.0" aria-label="æ—¶é€Ÿ" />
        </div>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>è·ç¦»</th>
              <th>å®Œèµ›æ—¶é—´</th>
              <th>é…é€Ÿ</th>
              <th>æ—¶é€Ÿ</th>
            </tr>
          </thead>
          <tbody id="quick-table-body"></tbody>
        </table>
      </div>
      <p class="table-note">
        ç‚¹å‡»è·ç¦»æŸ¥çœ‹åˆ†æ®µé…é€Ÿè¡¨ï¼Œåˆ†æ®µè§„åˆ™ï¼šæ€»è·ç¦» <span data-segment-threshold>15</span>
        <span data-unit-distance>å…¬é‡Œ</span> ä½¿ç”¨ 3<span data-unit-distance>å…¬é‡Œ</span>ï¼Œå…¶ä½™ä½¿ç”¨
        5<span data-unit-distance>å…¬é‡Œ</span>ã€‚
      </p>

      <section class="card segment-card" id="quick-segment-card" hidden>
        <div class="segment-toggle">
          <h3 id="segment-title">åˆ†æ®µé…é€Ÿè¡¨</h3>
          <span class="status-pill" id="segment-unit">å…¬é‡Œ</span>
          <span class="hint" id="segment-rule">æ¯ 5km åˆ†æ®µ</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>åˆ†æ®µ</th>
                <th>ç´¯è®¡è·ç¦»</th>
                <th>ç´¯è®¡ç”¨æ—¶</th>
                <th>å¹³å‡é…é€Ÿ</th>
              </tr>
            </thead>
            <tbody id="segment-table-body"></tbody>
          </table>
        </div>
      </section>
    </section>

    <section class="card section" id="flex-section">
      <h2>è‡ªç”±æ¨¡å¼</h2>
      <p class="subtle">å¡«å†™è·ç¦» + é€‰æ‹©ä¸€é¡¹è¾“å…¥ï¼Œå³å¯è®¡ç®—å¦å¤–ä¸¤é¡¹ï¼ˆæ—¶é—´ã€é…é€Ÿã€æ—¶é€Ÿï¼‰ã€‚</p>
      <div class="input-grid">
        <label>
          <span class="label-inline">
            è·ç¦»
            <span class="unit-inline">ï¼ˆ<span data-unit-distance>å…¬é‡Œ</span>ï¼‰</span>
          </span>
          <input type="number" id="flex-distance" min="0" step="0.01" placeholder="ä¾‹å¦‚ 10" />
        </label>
        <label>
          é€‰æ‹©è¾“å…¥é¡¹
          <select id="flex-input-type">
            <option value="time">æ—¶é—´ï¼ˆæ€»ç”¨æ—¶ï¼‰</option>
            <option value="pace" selected>é…é€Ÿ</option>
            <option value="speed">æ—¶é€Ÿ</option>
          </select>
        </label>
        <div data-flex-input="time" hidden>
          <div class="input-grid" style="grid-template-columns: repeat(3, minmax(70px, 1fr));">
            <input type="number" id="flex-hour" min="0" placeholder="æ—¶" aria-label="æ—¶é—´ å°æ—¶" />
            <input type="number" id="flex-min" min="0" max="59" placeholder="åˆ†" aria-label="æ—¶é—´ åˆ†é’Ÿ" />
            <input type="number" id="flex-sec" min="0" max="59" placeholder="ç§’" aria-label="æ—¶é—´ ç§’" />
          </div>
        </div>
        <div data-flex-input="pace" hidden>
          <div class="input-grid" style="grid-template-columns: repeat(2, minmax(80px, 1fr));">
            <input type="number" id="flex-pace-min" min="0" placeholder="åˆ†" aria-label="é…é€Ÿ åˆ†é’Ÿ" />
            <input type="number" id="flex-pace-sec" min="0" max="59" placeholder="ç§’" aria-label="é…é€Ÿ ç§’" />
          </div>
        </div>
        <div data-flex-input="speed" hidden>
          <input type="number" id="flex-speed" min="0" step="0.1" placeholder="ä¾‹å¦‚ 12.0" aria-label="æ—¶é€Ÿ" />
        </div>
      </div>

      <div class="divider"></div>
      <div class="result-grid">
        <div class="result-card">
          <span class="subtle">å®Œæˆæ—¶é—´</span>
          <strong id="flex-result-time">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">
            é…é€Ÿï¼ˆåˆ†:ç§’ / <span class="unit-inline"><span data-unit-distance>å…¬é‡Œ</span></span>ï¼‰
          </span>
          <strong id="flex-result-pace">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">
            æ—¶é€Ÿï¼ˆ<span class="unit-inline"><span data-unit-speed>km/h</span></span>ï¼‰
          </span>
          <strong id="flex-result-speed">--</strong>
        </div>
      </div>

      <h3>è®­ç»ƒè¿›åº¦æ¨ç®—</h3>
      <p class="subtle">åŸºäºè‡ªç”±æ¨¡å¼çš„è·ç¦»è¾“å…¥å½“å‰è¿›åº¦ï¼Œè‡ªåŠ¨ä½¿ç”¨ä¸Šæ–¹å®Œèµ›æ—¶é—´è®¡ç®—ç›®æ ‡é…é€Ÿä¸å‰©ä½™åˆ†æ®µè¡¨ã€‚</p>
      <div class="input-grid">
        <label>
          <span class="label-inline">
            å·²è·‘è·ç¦»
            <span class="unit-inline">ï¼ˆ<span data-unit-distance>å…¬é‡Œ</span>ï¼‰</span>
          </span>
          <input type="number" id="progress-current-distance" min="0" step="0.01" placeholder="ä¾‹å¦‚ 10" />
        </label>
        <label>
          å·²è·‘ç”¨æ—¶
          <div class="input-grid" style="grid-template-columns: repeat(3, minmax(70px, 1fr));">
            <input type="number" id="progress-hour" min="0" placeholder="æ—¶" />
            <input type="number" id="progress-min" min="0" max="59" placeholder="åˆ†" />
            <input type="number" id="progress-sec" min="0" max="59" placeholder="ç§’" />
          </div>
        </label>
      </div>

      <div class="result-grid">
        <div class="result-card">
          <span class="subtle">é¢„æµ‹å®Œèµ›æ—¶é—´</span>
          <strong id="progress-result-time">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">å½“å‰å¹³å‡é…é€Ÿ</span>
          <strong id="progress-result-pace">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">ä¸ç›®æ ‡é…é€Ÿå·®</span>
          <strong id="progress-result-diff">--</strong>
          <span class="hint" id="progress-diff-hint">è¯·å…ˆåœ¨è‡ªç”±æ¨¡å¼è®¡ç®—å®Œèµ›æ—¶é—´</span>
        </div>
      </div>

      <section class="card segment-card" id="remaining-segment-card" hidden>
        <div class="segment-toggle">
          <h3 id="remaining-title">å‰©ä½™åˆ†æ®µé…é€Ÿè¡¨</h3>
          <span class="status-pill" id="remaining-unit">å…¬é‡Œ</span>
          <span class="hint" id="remaining-rule">æŒ‰å‰©ä½™è·ç¦»åˆ†æ®µ</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>åˆ†æ®µ</th>
                <th>ç´¯è®¡è·ç¦»ï¼ˆå«å·²è·‘ï¼‰</th>
                <th>ç´¯è®¡ç”¨æ—¶ï¼ˆå«å·²è·‘ï¼‰</th>
                <th>å¹³å‡é…é€Ÿ</th>
              </tr>
            </thead>
            <tbody id="remaining-table-body"></tbody>
          </table>
        </div>
      </section>
    </section>

    <section class="card section" id="tempo-section">
      <h2>èŠ‚å¥è·‘æ¨¡å¼</h2>
      <p class="subtle">ä¸ºåŒä¸€æ¬¡è·‘æ­¥è®¾ç½®å¤šä¸ªåˆ†æ®µé…é€Ÿï¼Œè‡ªåŠ¨è®¡ç®—æ•´ä½“å¹³å‡é…é€Ÿä¸æ—¶é€Ÿã€‚</p>
      <div class="tempo-row tempo-row--header">
        <span>åˆ†æ®µè·ç¦»ï¼ˆ<span data-unit-distance>å…¬é‡Œ</span>ï¼‰</span>
        <span>è¾“å…¥ç±»å‹</span>
        <span>åˆ†æ®µè¾“å…¥</span>
        <span>æ“ä½œ</span>
      </div>
      <div class="tempo-rows" id="tempo-rows"></div>
      <div class="tempo-actions">
        <button type="button" id="tempo-add-row">æ–°å¢åˆ†æ®µ</button>
      </div>

      <div class="result-grid">
        <div class="result-card">
          <span class="subtle">æ€»è·ç¦»</span>
          <strong id="tempo-total-distance">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">æ€»ç”¨æ—¶</span>
          <strong id="tempo-total-time">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">å¹³å‡é…é€Ÿ</span>
          <strong id="tempo-avg-pace">--</strong>
        </div>
        <div class="result-card">
          <span class="subtle">å¹³å‡æ—¶é€Ÿ</span>
          <strong id="tempo-avg-speed">--</strong>
        </div>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>åˆ†æ®µ</th>
              <th>è·ç¦»</th>
              <th>ç”¨æ—¶</th>
              <th>é…é€Ÿ</th>
              <th>æ—¶é€Ÿ</th>
            </tr>
          </thead>
          <tbody id="tempo-table-body"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const copyButton = document.getElementById("copy-link");
    const unitButtons = document.querySelectorAll(".unit-toggle button");
    const unitLabels = {
      km: { name: "å…¬é‡Œ", paceUnit: "åˆ†:ç§’ / å…¬é‡Œ", speedUnit: "km/h", distanceUnit: "km" },
      mi: { name: "è‹±é‡Œ", paceUnit: "åˆ†:ç§’ / è‹±é‡Œ", speedUnit: "mph", distanceUnit: "mi" }
    };
    const milesPerKm = 0.621371;
    let currentUnit = "km";
    let selectedQuickDistance = null;
    let lastFlexTotalSeconds = 0;

    const quickDistances = {
      km: [
        { km: 3, unitValue: 3 },
        { km: 5, unitValue: 5 },
        { km: 10, unitValue: 10 },
        { km: 15, unitValue: 15 },
        { km: 20, unitValue: 20 },
        { km: 30, unitValue: 30 },
        { km: 21.0975, unitValue: 21.1, label: "åŠé©¬" },
        { km: 42.195, unitValue: 42.2, label: "å…¨é©¬" }
      ],
      mi: [
        { km: 3 / milesPerKm, unitValue: 3 },
        { km: 5 / milesPerKm, unitValue: 5 },
        { km: 10 / milesPerKm, unitValue: 10 },
        { km: 15 / milesPerKm, unitValue: 15 },
        { km: 20 / milesPerKm, unitValue: 20 },
        { km: 30 / milesPerKm, unitValue: 30 },
        { km: 21.0975, unitValue: 13.1, label: "åŠé©¬" },
        { km: 42.195, unitValue: 26.2, label: "å…¨é©¬" }
      ]
    };

    const quickTableBody = document.getElementById("quick-table-body");
    const quickInputType = document.getElementById("quick-input-type");
    const quickInputs = document.querySelectorAll("[data-quick-input]");
    const quickPaceOption = quickInputType.querySelector('option[value="pace"]');
    const quickSpeedOption = quickInputType.querySelector('option[value="speed"]');

    const timeHour = document.getElementById("time-hour");
    const timeMin = document.getElementById("time-min");
    const timeSec = document.getElementById("time-sec");

    const paceMin = document.getElementById("pace-min");
    const paceSec = document.getElementById("pace-sec");

    const speedInput = document.getElementById("speed-input");

    const flexDistance = document.getElementById("flex-distance");
    const flexInputType = document.getElementById("flex-input-type");
    const flexInputs = document.querySelectorAll("[data-flex-input]");
    const flexPaceOption = flexInputType.querySelector('option[value="pace"]');
    const flexSpeedOption = flexInputType.querySelector('option[value="speed"]');
    const flexHour = document.getElementById("flex-hour");
    const flexMin = document.getElementById("flex-min");
    const flexSec = document.getElementById("flex-sec");
    const flexPaceMin = document.getElementById("flex-pace-min");
    const flexPaceSec = document.getElementById("flex-pace-sec");
    const flexSpeed = document.getElementById("flex-speed");

    const flexResultTime = document.getElementById("flex-result-time");
    const flexResultPace = document.getElementById("flex-result-pace");
    const flexResultSpeed = document.getElementById("flex-result-speed");

    const tempoRows = document.getElementById("tempo-rows");
    const tempoAddRow = document.getElementById("tempo-add-row");
    const tempoTotalDistance = document.getElementById("tempo-total-distance");
    const tempoTotalTime = document.getElementById("tempo-total-time");
    const tempoAvgPace = document.getElementById("tempo-avg-pace");
    const tempoAvgSpeed = document.getElementById("tempo-avg-speed");
    const tempoTableBody = document.getElementById("tempo-table-body");

    const segmentCard = document.getElementById("quick-segment-card");
    const segmentTableBody = document.getElementById("segment-table-body");
    const segmentTitle = document.getElementById("segment-title");
    const segmentUnit = document.getElementById("segment-unit");
    const segmentRule = document.getElementById("segment-rule");

    const progressCurrentDistance = document.getElementById("progress-current-distance");
    const progressHour = document.getElementById("progress-hour");
    const progressMin = document.getElementById("progress-min");
    const progressSec = document.getElementById("progress-sec");

    const progressResultTime = document.getElementById("progress-result-time");
    const progressResultPace = document.getElementById("progress-result-pace");
    const progressResultDiff = document.getElementById("progress-result-diff");
    const progressDiffHint = document.getElementById("progress-diff-hint");

    const remainingSegmentCard = document.getElementById("remaining-segment-card");
    const remainingTableBody = document.getElementById("remaining-table-body");
    const remainingTitle = document.getElementById("remaining-title");
    const remainingUnit = document.getElementById("remaining-unit");
    const remainingRule = document.getElementById("remaining-rule");

    function toNumber(value) {
      const number = Number(value);
      return Number.isFinite(number) ? number : 0;
    }

    function parseTime(hours, minutes, seconds) {
      return toNumber(hours) * 3600 + toNumber(minutes) * 60 + toNumber(seconds);
    }

    function parsePace(minutes, seconds) {
      return toNumber(minutes) * 60 + toNumber(seconds);
    }

    function formatTime(totalSeconds) {
      if (!Number.isFinite(totalSeconds) || totalSeconds <= 0) {
        return "--";
      }
      const rounded = Math.round(totalSeconds);
      const hours = Math.floor(rounded / 3600);
      const minutes = Math.floor((rounded % 3600) / 60);
      const seconds = rounded % 60;
      const parts = [hours, minutes, seconds].map((part) => String(part).padStart(2, "0"));
      return parts.join(":");
    }

    function formatPace(secondsPerKm) {
      if (!Number.isFinite(secondsPerKm) || secondsPerKm <= 0) {
        return "--";
      }
      const rounded = Math.round(secondsPerKm);
      const minutes = Math.floor(rounded / 60);
      const seconds = rounded % 60;
      return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
    }

    function formatSpeed(kmPerHour) {
      if (!Number.isFinite(kmPerHour) || kmPerHour <= 0) {
        return "--";
      }
      return kmPerHour.toFixed(1);
    }

    function getUnitDistance(distanceKm) {
      return currentUnit === "km" ? distanceKm : distanceKm * milesPerKm;
    }

    function getSegmentSize(distanceKm) {
      const baseDistance = currentUnit === "km" ? distanceKm : distanceKm * milesPerKm;
      return baseDistance < 15 ? 3 : 5;
    }

    function formatDistance(distanceKm, decimals = 1) {
      const unitDistance = getUnitDistance(distanceKm);
      const rounded = unitDistance >= 10 ? unitDistance.toFixed(1) : unitDistance.toFixed(decimals);
      return `${rounded}${unitLabels[currentUnit].name}`;
    }

    function formatUnitValue(value, decimals = 2) {
      const rounded = value >= 10 ? value.toFixed(1) : value.toFixed(decimals);
      return `${rounded}${unitLabels[currentUnit].name}`;
    }

    function formatSpeedByUnit(kmPerHour) {
      if (!Number.isFinite(kmPerHour) || kmPerHour <= 0) {
        return "--";
      }
      const speed = currentUnit === "km" ? kmPerHour : kmPerHour * milesPerKm;
      return speed.toFixed(1);
    }

    function formatPaceByUnit(secondsPerKm) {
      if (!Number.isFinite(secondsPerKm) || secondsPerKm <= 0) {
        return "--";
      }
      const secondsPerUnit = currentUnit === "km" ? secondsPerKm : secondsPerKm / milesPerKm;
      return formatPace(secondsPerUnit);
    }

    function convertDistanceToKm(distanceValue) {
      if (!Number.isFinite(distanceValue) || distanceValue <= 0) {
        return 0;
      }
      return currentUnit === "km" ? distanceValue : distanceValue / milesPerKm;
    }

    function convertPaceToKm(paceSeconds) {
      if (!Number.isFinite(paceSeconds) || paceSeconds <= 0) {
        return 0;
      }
      return currentUnit === "km" ? paceSeconds : paceSeconds * milesPerKm;
    }

    function convertSpeedToKm(speedValue) {
      if (!Number.isFinite(speedValue) || speedValue <= 0) {
        return 0;
      }
      return currentUnit === "km" ? speedValue : speedValue / milesPerKm;
    }

    function updateUnitLabels() {
      const distanceLabels = document.querySelectorAll("[data-unit-distance]");
      const speedLabels = document.querySelectorAll("[data-unit-speed]");
      distanceLabels.forEach((label) => {
        label.textContent = unitLabels[currentUnit].distanceUnit === "km" ? "å…¬é‡Œ" : "è‹±é‡Œ";
      });
      speedLabels.forEach((label) => {
        label.textContent = unitLabels[currentUnit].speedUnit;
      });
      quickPaceOption.textContent = `é…é€Ÿï¼ˆåˆ†:ç§’ / ${unitLabels[currentUnit].name}ï¼‰`;
      quickSpeedOption.textContent = `æ—¶é€Ÿï¼ˆ${unitLabels[currentUnit].speedUnit}ï¼‰`;
      flexPaceOption.textContent = `é…é€Ÿï¼ˆåˆ†:ç§’ / ${unitLabels[currentUnit].name}ï¼‰`;
      flexSpeedOption.textContent = `æ—¶é€Ÿï¼ˆ${unitLabels[currentUnit].speedUnit}ï¼‰`;
      tempoRows.querySelectorAll("[data-tempo-type]").forEach((select) => {
        const paceOption = select.querySelector('option[value="pace"]');
        const speedOption = select.querySelector('option[value="speed"]');
        if (paceOption) {
          paceOption.textContent = `é…é€Ÿï¼ˆåˆ†:ç§’ / ${unitLabels[currentUnit].name}ï¼‰`;
        }
        if (speedOption) {
          speedOption.textContent = `æ—¶é€Ÿï¼ˆ${unitLabels[currentUnit].speedUnit}ï¼‰`;
        }
      });
    }

    function convertInputValue(value, multiplier) {
      if (!Number.isFinite(value) || value <= 0) {
        return "";
      }
      return (value * multiplier).toFixed(2);
    }

    function convertPaceInputs(multiplier) {
      const paceValue = parsePace(paceMin.value, paceSec.value);
      if (paceValue > 0) {
        const converted = paceValue * multiplier;
        const minutes = Math.floor(converted / 60);
        const seconds = Math.round(converted % 60);
        paceMin.value = minutes;
        paceSec.value = seconds;
      }

      const flexPaceValue = parsePace(flexPaceMin.value, flexPaceSec.value);
      if (flexPaceValue > 0) {
        const converted = flexPaceValue * multiplier;
        const minutes = Math.floor(converted / 60);
        const seconds = Math.round(converted % 60);
        flexPaceMin.value = minutes;
        flexPaceSec.value = seconds;
      }
    }

    function convertTempoInputs(distanceMultiplier, paceMultiplier) {
      tempoRows.querySelectorAll("[data-tempo-row]").forEach((row) => {
        const distanceInput = row.querySelector("[data-tempo-distance]");
        const paceMinInput = row.querySelector("[data-tempo-pace-min]");
        const paceSecInput = row.querySelector("[data-tempo-pace-sec]");

        distanceInput.value = convertInputValue(toNumber(distanceInput.value), distanceMultiplier);

        const paceValue = parsePace(paceMinInput.value, paceSecInput.value);
        if (paceValue > 0) {
          const converted = paceValue * paceMultiplier;
          paceMinInput.value = Math.floor(converted / 60);
          paceSecInput.value = Math.round(converted % 60);
        }
      });
    }

    function convertUnits(fromUnit, toUnit) {
      if (fromUnit === toUnit) {
        return;
      }
      const multiplier = fromUnit === "km" && toUnit === "mi" ? milesPerKm : 1 / milesPerKm;

      flexDistance.value = convertInputValue(toNumber(flexDistance.value), multiplier);
      progressCurrentDistance.value = convertInputValue(toNumber(progressCurrentDistance.value), multiplier);

      speedInput.value = convertInputValue(toNumber(speedInput.value), multiplier);
      flexSpeed.value = convertInputValue(toNumber(flexSpeed.value), multiplier);

      convertPaceInputs(fromUnit === "km" && toUnit === "mi" ? 1 / milesPerKm : milesPerKm);
      convertTempoInputs(
        multiplier,
        fromUnit === "km" && toUnit === "mi" ? 1 / milesPerKm : milesPerKm
      );
    }

    function buildSegments(distanceKm, totalSeconds) {
      if (!Number.isFinite(distanceKm) || distanceKm <= 0 || !Number.isFinite(totalSeconds) || totalSeconds <= 0) {
        return [];
      }
      const unitDistance = getUnitDistance(distanceKm);
      const segmentSize = getSegmentSize(distanceKm);
      const fullSegments = Math.floor(unitDistance / segmentSize);
      const remainder = unitDistance - fullSegments * segmentSize;
      const secondsPerKm = totalSeconds / distanceKm;
      const segments = [];
      let cumulativeDistance = 0;
      let cumulativeSeconds = 0;

      for (let i = 0; i < fullSegments; i += 1) {
        cumulativeDistance += segmentSize;
        cumulativeSeconds += (totalSeconds / unitDistance) * segmentSize;
        segments.push({
          label: `ç¬¬ ${i + 1} æ®µ`,
          distanceValue: cumulativeDistance,
          distanceDecimals: 1,
          timeSeconds: cumulativeSeconds,
          pace: formatPaceByUnit(secondsPerKm)
        });
      }

      if (remainder > 0.05) {
        cumulativeDistance += remainder;
        cumulativeSeconds += (totalSeconds / unitDistance) * remainder;
        segments.push({
          label: `ç¬¬ ${segments.length + 1} æ®µ`,
          distanceValue: cumulativeDistance,
          distanceDecimals: 2,
          timeSeconds: cumulativeSeconds,
          pace: formatPaceByUnit(secondsPerKm)
        });
      }

      return { segments, segmentSize };
    }

    function renderSegmentTable(rows, body, { distanceOffset = 0, timeOffset = 0 } = {}) {
      body.innerHTML = rows
        .map(
          (row) => `
          <tr>
            <td>${row.label}</td>
            <td>${formatUnitValue(row.distanceValue + distanceOffset, row.distanceDecimals)}</td>
            <td>${formatTime(row.timeSeconds + timeOffset)}</td>
            <td>${row.pace}</td>
          </tr>
        `
        )
        .join("");
    }

    function renderQuickTable(rows) {
      quickTableBody.innerHTML = rows
        .map(
          (row) => `
          <tr data-distance="${row.distanceKm}">
            <td>${row.label}</td>
            <td>${row.time}</td>
            <td>${row.pace}</td>
            <td>${row.speed}</td>
          </tr>
        `
        )
        .join("");
    }

    function getQuickDistanceLabel(distance) {
      const formatted = formatUnitValue(distance.unitValue, 1);
      return distance.label ? `${distance.label} (${formatted})` : formatted;
    }

    function updateQuickMode() {
      const type = quickInputType.value;
      quickInputs.forEach((input) => {
        input.hidden = input.dataset.quickInput !== type;
      });

      let rows = quickDistances[currentUnit].map((distance) => {
        let totalSeconds = 0;
        if (type === "time") {
          totalSeconds = parseTime(timeHour.value, timeMin.value, timeSec.value);
        }
        if (type === "pace") {
          const paceSeconds = convertPaceToKm(parsePace(paceMin.value, paceSec.value));
          totalSeconds = paceSeconds * distance.km;
        }
        if (type === "speed") {
          const speedValue = convertSpeedToKm(toNumber(speedInput.value));
          totalSeconds = speedValue > 0 ? (distance.km / speedValue) * 3600 : 0;
        }

        const paceSeconds = totalSeconds > 0 ? totalSeconds / distance.km : 0;
        const speedValue = totalSeconds > 0 ? distance.km / (totalSeconds / 3600) : 0;

        return {
          label: getQuickDistanceLabel(distance),
          time: formatTime(totalSeconds),
          pace: formatPaceByUnit(paceSeconds),
          speed: formatSpeedByUnit(speedValue),
          distanceKm: distance.km
        };
      });

      renderQuickTable(rows);
      bindQuickRowEvents();
      updateSegmentCard(selectedQuickDistance);
    }

    function bindQuickRowEvents() {
      document.querySelectorAll("#quick-table-body tr").forEach((row) => {
        row.addEventListener("click", () => {
          const distanceKm = toNumber(row.dataset.distance);
          selectedQuickDistance = distanceKm;
          updateSegmentCard(distanceKm);
        });
      });
    }

    function updateSegmentCard(distanceKm) {
      if (!distanceKm) {
        segmentCard.hidden = true;
        return;
      }
      const paceSeconds = convertPaceToKm(parsePace(paceMin.value, paceSec.value));
      const totalSeconds =
        quickInputType.value === "pace"
          ? paceSeconds * distanceKm
          : quickInputType.value === "time"
          ? parseTime(timeHour.value, timeMin.value, timeSec.value)
          : quickInputType.value === "speed"
          ? (() => {
              const speedValue = convertSpeedToKm(toNumber(speedInput.value));
              return speedValue > 0 ? (distanceKm / speedValue) * 3600 : 0;
            })()
          : 0;

      const segmentData = buildSegments(distanceKm, totalSeconds);
      if (!segmentData || segmentData.segments.length === 0) {
        segmentCard.hidden = true;
        return;
      }

      segmentCard.hidden = false;
      segmentTitle.textContent = `${formatDistance(distanceKm, 2)} åˆ†æ®µé…é€Ÿè¡¨`;
      segmentUnit.textContent = unitLabels[currentUnit].name;
      segmentRule.textContent = `æ¯ ${segmentData.segmentSize} ${unitLabels[currentUnit].name} åˆ†æ®µ`;
      renderSegmentTable(segmentData.segments, segmentTableBody);
    }

    function updateFlexMode() {
      const inputType = flexInputType.value;
      flexInputs.forEach((input) => {
        input.hidden = input.dataset.flexInput !== inputType;
      });

      const distanceKm = convertDistanceToKm(toNumber(flexDistance.value));
      const timeSeconds = parseTime(flexHour.value, flexMin.value, flexSec.value);
      const paceSeconds = convertPaceToKm(parsePace(flexPaceMin.value, flexPaceSec.value));
      const speedValue = convertSpeedToKm(toNumber(flexSpeed.value));

      let totalSeconds = 0;

      if (distanceKm > 0) {
        if (inputType === "time" && timeSeconds > 0) {
          totalSeconds = timeSeconds;
        } else if (inputType === "pace" && paceSeconds > 0) {
          totalSeconds = paceSeconds * distanceKm;
        } else if (inputType === "speed" && speedValue > 0) {
          totalSeconds = (distanceKm / speedValue) * 3600;
        }
      }

      const finalPace = totalSeconds > 0 && distanceKm > 0 ? totalSeconds / distanceKm : 0;
      const finalSpeed = totalSeconds > 0 ? distanceKm / (totalSeconds / 3600) : 0;

      lastFlexTotalSeconds = totalSeconds;
      flexResultTime.textContent = formatTime(totalSeconds);
      flexResultPace.textContent = formatPaceByUnit(finalPace);
      flexResultSpeed.textContent = formatSpeedByUnit(finalSpeed);
      updateProgressMode();
    }

    function createTempoRow() {
      const row = document.createElement("div");
      row.className = "tempo-row";
      row.dataset.tempoRow = "true";
      row.innerHTML = `
        <input type="number" min="0" step="0.01" placeholder="åˆ†æ®µè·ç¦»" data-tempo-distance aria-label="åˆ†æ®µè·ç¦»" />
        <select data-tempo-type aria-label="åˆ†æ®µè¾“å…¥ç±»å‹">
          <option value="pace" selected>é…é€Ÿ</option>
          <option value="time">æ—¶é—´</option>
          <option value="speed">æ—¶é€Ÿ</option>
        </select>
        <div class="tempo-input tempo-input--pace active" data-tempo-input="pace">
          <div class="pace-inputs">
            <input type="number" min="0" placeholder="åˆ†" data-tempo-pace-min aria-label="åˆ†æ®µé…é€Ÿ åˆ†é’Ÿ" />
            <input type="number" min="0" max="59" placeholder="ç§’" data-tempo-pace-sec aria-label="åˆ†æ®µé…é€Ÿ ç§’" />
          </div>
        </div>
        <div class="tempo-input tempo-input--time" data-tempo-input="time">
          <div class="pace-inputs" style="grid-template-columns: repeat(3, minmax(70px, 1fr));">
            <input type="number" min="0" placeholder="æ—¶" data-tempo-hour aria-label="åˆ†æ®µæ—¶é—´ å°æ—¶" />
            <input type="number" min="0" max="59" placeholder="åˆ†" data-tempo-min aria-label="åˆ†æ®µæ—¶é—´ åˆ†é’Ÿ" />
            <input type="number" min="0" max="59" placeholder="ç§’" data-tempo-sec aria-label="åˆ†æ®µæ—¶é—´ ç§’" />
          </div>
        </div>
        <div class="tempo-input tempo-input--speed" data-tempo-input="speed">
          <input type="number" min="0" step="0.1" placeholder="ä¾‹å¦‚ 12.0" data-tempo-speed aria-label="åˆ†æ®µæ—¶é€Ÿ" />
        </div>
        <button type="button" data-tempo-remove>ç§»é™¤</button>
      `;
      row.querySelectorAll("input").forEach((input) => {
        input.addEventListener("input", updateTempoMode);
      });
      row.querySelector("[data-tempo-type]").addEventListener("change", (event) => {
        row.querySelectorAll("[data-tempo-input]").forEach((input) => {
          input.classList.toggle("active", input.dataset.tempoInput === event.target.value);
        });
        updateTempoMode();
      });
      row.querySelector("[data-tempo-remove]").addEventListener("click", () => {
        row.remove();
        updateTempoMode();
      });
      return row;
    }

    function updateTempoMode() {
      let totalDistanceKm = 0;
      let totalSeconds = 0;
      const segments = [];

      tempoRows.querySelectorAll("[data-tempo-row]").forEach((row) => {
        const distanceValue = toNumber(row.querySelector("[data-tempo-distance]").value);
        const inputType = row.querySelector("[data-tempo-type]").value;
        const paceMinValue = row.querySelector("[data-tempo-pace-min]")?.value;
        const paceSecValue = row.querySelector("[data-tempo-pace-sec]")?.value;
        const timeHourValue = row.querySelector("[data-tempo-hour]")?.value;
        const timeMinValue = row.querySelector("[data-tempo-min]")?.value;
        const timeSecValue = row.querySelector("[data-tempo-sec]")?.value;
        const speedValue = toNumber(row.querySelector("[data-tempo-speed]")?.value);
        const distanceKm = convertDistanceToKm(distanceValue);
        let segmentSeconds = 0;

        if (distanceKm > 0) {
          if (inputType === "pace") {
            const paceSecondsKm = convertPaceToKm(parsePace(paceMinValue, paceSecValue));
            segmentSeconds = paceSecondsKm > 0 ? paceSecondsKm * distanceKm : 0;
          } else if (inputType === "time") {
            segmentSeconds = parseTime(timeHourValue, timeMinValue, timeSecValue);
          } else if (inputType === "speed") {
            const speedKm = convertSpeedToKm(speedValue);
            segmentSeconds = speedKm > 0 ? (distanceKm / speedKm) * 3600 : 0;
          }
        }

        if (distanceKm > 0 && segmentSeconds > 0) {
          totalDistanceKm += distanceKm;
          totalSeconds += segmentSeconds;
          const segmentPace = segmentSeconds / distanceKm;
          const segmentSpeed = distanceKm / (segmentSeconds / 3600);
          segments.push({
            distance: formatDistance(distanceKm, 2),
            time: formatTime(segmentSeconds),
            pace: formatPaceByUnit(segmentPace),
            speed: formatSpeedByUnit(segmentSpeed)
          });
        }
      });

      const avgPace = totalDistanceKm > 0 ? totalSeconds / totalDistanceKm : 0;
      const avgSpeed = totalSeconds > 0 ? totalDistanceKm / (totalSeconds / 3600) : 0;

      tempoTotalDistance.textContent = totalDistanceKm > 0 ? formatDistance(totalDistanceKm, 2) : "--";
      tempoTotalTime.textContent = formatTime(totalSeconds);
      tempoAvgPace.textContent = formatPaceByUnit(avgPace);
      tempoAvgSpeed.textContent = formatSpeedByUnit(avgSpeed);

      tempoTableBody.innerHTML = segments
        .map(
          (segment, index) => `
          <tr>
            <td>ç¬¬ ${index + 1} æ®µ</td>
            <td>${segment.distance}</td>
            <td>${segment.time}</td>
            <td>${segment.pace}</td>
            <td>${segment.speed}</td>
          </tr>
        `
        )
        .join("");
    }

    function updateProgressMode() {
      const totalDistanceKm = convertDistanceToKm(toNumber(flexDistance.value));
      const currentDistanceKm = convertDistanceToKm(toNumber(progressCurrentDistance.value));
      const elapsedSeconds = parseTime(progressHour.value, progressMin.value, progressSec.value);
      const targetSeconds = lastFlexTotalSeconds;

      const currentPace = currentDistanceKm > 0 ? elapsedSeconds / currentDistanceKm : 0;
      const predictedFinish = totalDistanceKm > 0 && currentPace > 0 ? totalDistanceKm * currentPace : 0;

      progressResultTime.textContent = formatTime(predictedFinish);
      progressResultPace.textContent = formatPaceByUnit(currentPace);

      if (targetSeconds > 0 && totalDistanceKm > 0 && currentPace > 0) {
        const targetPace = targetSeconds / totalDistanceKm;
        const diff = currentPace - targetPace;
        const diffText = diff === 0 ? "æŒå¹³" : diff > 0 ? "æ…¢äºç›®æ ‡" : "å¿«äºç›®æ ‡";
        progressResultDiff.textContent = `${diffText} ${formatPaceByUnit(Math.abs(diff))}`;
        progressDiffHint.textContent = `ç›®æ ‡é…é€Ÿï¼š${formatPaceByUnit(targetPace)}`;
      } else {
        progressResultDiff.textContent = "--";
        progressDiffHint.textContent = "è¯·å…ˆåœ¨è‡ªç”±æ¨¡å¼è®¡ç®—å®Œèµ›æ—¶é—´";
      }

      const remainingDistanceKm = totalDistanceKm - currentDistanceKm;
      const remainingSeconds = targetSeconds - elapsedSeconds;
      if (remainingDistanceKm > 0 && remainingSeconds > 0) {
        const segmentData = buildSegments(remainingDistanceKm, remainingSeconds);
        if (segmentData && segmentData.segments.length > 0) {
          const currentDistanceUnit = getUnitDistance(currentDistanceKm);
          remainingSegmentCard.hidden = false;
          remainingTitle.textContent = `å‰©ä½™ ${formatDistance(remainingDistanceKm, 2)} é…é€Ÿè¡¨`;
          remainingUnit.textContent = unitLabels[currentUnit].name;
          remainingRule.textContent = `æŒ‰å‰©ä½™è·ç¦»æ¯ ${segmentData.segmentSize} ${unitLabels[currentUnit].name} åˆ†æ®µ`;
          renderSegmentTable(segmentData.segments, remainingTableBody, {
            distanceOffset: currentDistanceUnit,
            timeOffset: elapsedSeconds
          });
        } else {
          remainingSegmentCard.hidden = true;
        }
      } else {
        remainingSegmentCard.hidden = true;
      }
    }

    function bindInputs(inputs, handler) {
      inputs.forEach((input) => {
        input.addEventListener("input", handler);
        input.addEventListener("change", handler);
      });
    }

    bindInputs([quickInputType, timeHour, timeMin, timeSec, paceMin, paceSec, speedInput], updateQuickMode);
    bindInputs(
      [flexDistance, flexInputType, flexHour, flexMin, flexSec, flexPaceMin, flexPaceSec, flexSpeed],
      updateFlexMode
    );
    bindInputs([progressCurrentDistance, progressHour, progressMin, progressSec], updateProgressMode);

    tempoAddRow.addEventListener("click", () => {
      tempoRows.appendChild(createTempoRow());
      updateTempoMode();
    });

    unitButtons.forEach((button) => {
      button.addEventListener("click", () => {
        unitButtons.forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");
        const nextUnit = button.dataset.unit;
        convertUnits(currentUnit, nextUnit);
        currentUnit = nextUnit;
        updateUnitLabels();
        updateQuickMode();
        updateFlexMode();
        updateProgressMode();
      });
    });

    document.querySelectorAll(".mode-toggle button").forEach((button) => {
      button.addEventListener("click", () => {
        document.querySelectorAll(".mode-toggle button").forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");
        const mode = button.dataset.mode;
        document.getElementById("quick-section").classList.toggle("active", mode === "quick");
        document.getElementById("flex-section").classList.toggle("active", mode === "flex");
        document.getElementById("tempo-section").classList.toggle("active", mode === "tempo");
      });
    });

    updateQuickMode();
    updateFlexMode();
    updateProgressMode();
    updateUnitLabels();
    tempoRows.appendChild(createTempoRow());
    updateTempoMode();

    copyButton.addEventListener("click", async () => {
      const url = window.location.href;
      try {
        await navigator.clipboard.writeText(url);
        copyButton.textContent = "å·²å¤åˆ¶";
      } catch (error) {
        window.prompt("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š", url);
      }
      window.setTimeout(() => {
        copyButton.textContent = "å¤åˆ¶æ­¤å·¥å…·é“¾æ¥";
      }, 1500);
    });
  </script>
</body>
</html>
